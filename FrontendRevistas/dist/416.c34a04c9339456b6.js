"use strict";(self.webpackChunkAppTuristica=self.webpackChunkAppTuristica||[]).push([[416],{8416:(V,m,i)=>{i.r(m),i.d(m,{UserRolesModule:()=>w});var d=i(9808),g=i(1813),p=i(520),e=i(7587),v=i(4738),S=i(9783),u=i(3075),h=i(2145),f=i(1208),C=i(97);function R(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"p-checkbox",10),e.NdJ("ngModelChange",function(r){const l=e.CHM(o).$implicit;return e.oxw(2).onRolChange(l,r)}),e.qZA(),e.qZA()}if(2&t){const o=a.$implicit,s=e.oxw(2);e.xp6(1),e.Q6J("inputId","rol_"+o.id)("value",o.id.toString())("binary",!0)("label",o.name)("ngModel",s.isRolSelected(o))("name","rol_"+o.id)}}function M(t,a){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,R,2,6,"div",9),e.qZA()),2&t){const o=e.oxw();e.xp6(1),e.Q6J("ngForOf",o.roles)}}function Z(t,a){if(1&t&&(e.ynx(0),e.TgZ(1,"tr"),e.TgZ(2,"td"),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.qZA(),e.BQk()),2&t){const o=a.$implicit;e.xp6(3),e.Oqu(o.key),e.xp6(2),e.Oqu(o.value.join(", "))}}const y=[{path:"ver",component:(()=>{class t{constructor(o,s,r){this.usuariosService=o,this.messageService=s,this.http=r,this.usuarios=[],this.roles=[],this.usuarioSeleccionado={},this.AllRoles=[],this.usuarioRolesMap=new Map,this.filteredUsuarios=[],this.rolesSeleccionados=[],this.nuevosRolesSeleccionados=[]}ngOnInit(){this.usuariosService.getUsers().subscribe(o=>{this.usuarios=o}),this.usuariosService.getRoles().subscribe(o=>{this.roles=o}),this.procesarRoles(),this.getRol()}searchUsuarios(o){const s=this.usuarios.filter(r=>r.username.toLowerCase().includes(o.query.toLowerCase()));this.filteredUsuarios=s}getRol(){this.usuariosService.getAllRoles().subscribe(o=>{this.AllRoles=o,this.procesarRoles()})}procesarRoles(){this.usuarioRolesMap.clear(),this.AllRoles.forEach(s=>{const r=s.userId.username,n=Array.isArray(s.rolesId)?s.rolesId.map(l=>l.name):[s.rolesId.name];if(this.usuarioRolesMap.has(r)){const l=this.usuarioRolesMap.get(r)||[];l.push(...n),this.usuarioRolesMap.set(r,Array.from(new Set(l)))}else this.usuarioRolesMap.set(r,Array.from(new Set(n)))});const o=this.usuarioRolesMap.get(this.usuarioSeleccionado.username)||[];this.rolesSeleccionados=o.map(s=>{const r=this.roles.find(n=>n.name===s);return r?r.id:null})}onUsuarioSelect(o){this.usuarioSeleccionado=o,this.rolesSeleccionados=this.getAllRolesForUsuario(this.usuarioSeleccionado.id)}getAllRolesForUsuario(o){const s=[];return this.AllRoles.filter(n=>n.userId.id===o).forEach(n=>{s.push(n.rolesId.id)}),s}isRolSelected(o){return this.rolesSeleccionados.some(s=>s===o.id)}onRolChange(o,s){const r=Number(o.id);if(s)this.rolesSeleccionados.includes(r)||(this.rolesSeleccionados.push(r),this.asignarRol());else{const n=this.rolesSeleccionados.indexOf(r);if(-1!==n)return this.rolesSeleccionados.splice(n,1),void this.deleteUserRole(o)}}asignarRol(){if(0===this.rolesSeleccionados.length)return;const o=this.rolesSeleccionados[this.rolesSeleccionados.length-1],s=this.buscarUserRole(this.usuarioSeleccionado.id,o);if(s)s.status||(s.status=!0,this.actualizarUserRole(s.id,s));else{const n=JSON.stringify({status:!0,userId:this.usuarioSeleccionado.id,rolesId:o}),l={headers:new p.WM({"Content-Type":"application/json"})};this.usuariosService.asignarRoles(n,l).subscribe(c=>{this.messageService.add({severity:"success",summary:"Rol asignado satisfactoriamente"}),this.getAllRolesForUsuario(this.usuarioSeleccionado.id)},c=>{console.error("Error al asignar el rol",c),this.messageService.add({severity:"error",summary:"Error al asignar el rol"})})}}actualizarUserRole(o,s){const n=JSON.stringify({status:s.status,userId:s.userId.id,rolesId:s.rolesId.id}),l={headers:new p.WM({"Content-Type":"application/json"})};this.usuariosService.actualizarUserRole(o,n,l).subscribe(c=>{this.messageService.add({severity:"success",summary:"Rol actualizado satisfactoriamente"}),this.getAllRolesForUsuario(this.usuarioSeleccionado.id)},c=>{console.error("Error al actualizar el rol",c),this.messageService.add({severity:"error",summary:"Error al actualizar el rol"})})}buscarUserRole(o,s){return this.AllRoles.find(r=>r.userId.id===o&&r.rolesId.id===s)}deleteUserRole(o){const n=this.buscarUserRole(this.usuarioSeleccionado.id,o.id);n?this.usuariosService.deleteUserRole(n.id).subscribe(()=>{this.messageService.add({severity:"success",summary:"Rol eliminado satisfactoriamente"})},c=>{console.error("Error al eliminar el user_roles",c),this.messageService.add({severity:"error",summary:"Error al eliminar el rol"})}):console.error("No se encontr\xf3 ning\xfan registro de user_roles coincidente")}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(v.J),e.Y36(S.ez),e.Y36(p.eN))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-ver"]],decls:28,vars:7,consts:[[1,"formacion-title"],[1,"container"],["name","usuarioForm",1,"form"],[1,"form-group"],["for","usuario"],["name","usuario","field","username","placeholder","Seleccionar usuario",3,"ngModel","suggestions","minLength","ngModelChange","completeMethod","onSelect"],["for","rol"],[4,"ngIf"],[1,"user-list"],[4,"ngFor","ngForOf"],[3,"inputId","value","binary","label","ngModel","name","ngModelChange"]],template:function(o,s){1&o&&(e._UZ(0,"br"),e._UZ(1,"br"),e.TgZ(2,"h2",0),e._uU(3,"ASIGNAR ROLES"),e.qZA(),e.TgZ(4,"div",1),e.TgZ(5,"form",2),e.TgZ(6,"div",3),e.TgZ(7,"label",4),e._uU(8,"Usuario:"),e.qZA(),e.TgZ(9,"p-autoComplete",5),e.NdJ("ngModelChange",function(n){return s.usuarioSeleccionado=n})("completeMethod",function(n){return s.searchUsuarios(n)})("onSelect",function(n){return s.onUsuarioSelect(n)}),e.qZA(),e.qZA(),e.TgZ(10,"div",3),e.TgZ(11,"label",6),e._uU(12,"Roles:"),e.qZA(),e.YNc(13,M,2,1,"div",7),e.qZA(),e.qZA(),e._UZ(14,"p-messages"),e.qZA(),e.TgZ(15,"div",8),e.TgZ(16,"h3"),e._uU(17,"Listado de usuarios y sus roles"),e.qZA(),e.TgZ(18,"table"),e.TgZ(19,"thead"),e.TgZ(20,"tr"),e.TgZ(21,"th"),e._uU(22,"Usuario"),e.qZA(),e.TgZ(23,"th"),e._uU(24,"Rol (roles)"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(25,"tbody"),e.YNc(26,Z,6,2,"ng-container",9),e.ALo(27,"keyvalue"),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(9),e.Q6J("ngModel",s.usuarioSeleccionado)("suggestions",s.filteredUsuarios)("minLength",1),e.xp6(4),e.Q6J("ngIf",s.usuarioSeleccionado.username),e.xp6(13),e.Q6J("ngForOf",e.lcZ(27,5,s.usuarioRolesMap)))},directives:[u._Y,u.JL,u.F,h.Qc,u.JJ,u.On,d.O5,d.sg,f.XZ,C.V],pipes:[d.Nd],styles:["h2[_ngcontent-%COMP%]{color:#333}label[_ngcontent-%COMP%]{display:block;margin-bottom:10px}input[type=number][_ngcontent-%COMP%]{width:200px;padding:5px}h4[_ngcontent-%COMP%]{margin-top:20px}button[_ngcontent-%COMP%]{margin-top:10px;padding:10px 20px;background-color:#007bff;color:#fff;border:none;cursor:pointer}.container[_ngcontent-%COMP%]{max-width:400px;margin:0 auto;padding:20px;background-color:#f5f5f5;border-radius:5px;box-shadow:0 2px 5px #0000001a}.form-group[_ngcontent-%COMP%]{margin-bottom:20px;width:max-content;align-items:center;align-content:center}.select-container[_ngcontent-%COMP%], .p-button[_ngcontent-%COMP%]{width:100%}.p-messages[_ngcontent-%COMP%]{margin-top:10px}.user-list[_ngcontent-%COMP%]{margin-top:30px}.user-list[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:10px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:8px;border:1px solid #ccc}th[_ngcontent-%COMP%]{background-color:#f5f5f5;font-weight:700;text-align:left}.p-dropdown[_ngcontent-%COMP%]{width:100%}.p-dropdown[_ngcontent-%COMP%]   .p-dropdown-trigger[_ngcontent-%COMP%]   .p-dropdown-trigger-icon[_ngcontent-%COMP%]{right:.5rem;top:calc(50% - .25rem)}.p-dropdown[_ngcontent-%COMP%]   .p-dropdown-panel[_ngcontent-%COMP%]{max-height:200px}"]}),t})()},{path:"editar",component:(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-editar"]],decls:2,vars:0,template:function(o,s){1&o&&(e.TgZ(0,"p"),e._uU(1,"editar works!"),e.qZA())},styles:[""]}),t})()},{path:"eliminar",component:(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-eliminar"]],decls:2,vars:0,template:function(o,s){1&o&&(e.TgZ(0,"p"),e._uU(1,"eliminar works!"),e.qZA())},styles:[""]}),t})()},{path:"crear",component:(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-crear"]],decls:2,vars:0,template:function(o,s){1&o&&(e.TgZ(0,"p"),e._uU(1,"crear works!"),e.qZA())},styles:[""]}),t})()}];let U=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[g.Bz.forChild(y)],g.Bz]}),t})();var A=i(6697),x=i(845),T=i(9114),O=i(8061),b=i(5315),I=i(1424),E=i(657),P=i(1497),F=i(6526),J=i(4036);let w=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[d.ez,U,f.nD,C.$,A.U$,x.hJ,T.D,O.Q,b.S,I.j,u.u5,u.UX,E.kK,h.WN,P.EV,F.q4,J.kW]]}),t})()}}]);